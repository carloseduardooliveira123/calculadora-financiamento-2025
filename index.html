function calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar, prazoMeses, idade) {
            const banco = bancosConfig[bancoCodigo];
            let valorFinanciar = valorImovel - valorEntrada;
            
            debugLog(`${banco.nome}: Valor inicial a financiar = ${valorFinanciar}`);
            
            // Verificar se √© eleg√≠vel para MCMV
            const elegibilidadeMcmv = verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar);
            debugLog(`MCMV: ${elegibilidadeMcmv.elegivel ? 'Eleg√≠vel' : elegibilidadeMcmv.motivo}`);
            
            let taxa = banco.taxa;
            let subsidio = 0;
            
            // Ajustar taxa baseado no tipo de im√≥vel
            if (tipoImovelAtual === 'usado') {
                taxa += 0.5; // Im√≥veis usados t√™m taxa 0.5% maior
                debugLog(`Taxa ajustada para im√≥vel usado: ${taxa}%`);
            }

            // Verificar benef√≠cios para jovens (at√© 35 anos)
            const beneficioJovem = idade <= 35;
            if (beneficioJovem) {
                taxa -= 0.3; // Desconto de 0.3% para jovens
                debugLog(`Desconto jovem aplicado: ${taxa}%`);
            }
            
            if (elegibilidadeMcmv.elegivel) {
                taxa = banco.taxaMcmv || banco.taxa;
                subsidio = banco.subsidioMcmv || 0;
                valorFinanciar = Math.max(0, valorFinanciar - subsidio);
                debugLog(`MCMV aplicado: Taxa=${taxa}%, Subs√≠dio=${subsidio}, Valor final=${valorFinanciar}`);
            }

            // Verificar percentual m√°ximo de financiamento baseado no tipo de im√≥vel
            let maxFinanciamento = banco.maxFinanciamento;
            if (tipoImovelAtual === 'usado') {
                maxFinanciamento = Math.min(maxFinanciamento, 80); // Usado m√°ximo 80%
            }
            if (elegibilidadeMcmv.elegivel) {
                maxFinanciamento = 90; // MCMV permite 90%
            }

            const percentualFinanciamento = (valorFinanciar / valorImovel) * 100;
            
            debugLog(`Percentual financiamento: ${percentualFinanciamento.toFixed(1)}% (M√°x: ${maxFinanciamento}%)`);
            
            if (percentualFinanciamento > maxFinanciamento) {
                const entradaMinima = valorImovel * (1 - maxFinanciamento / 100);
                debugLog(`REPROVADO: Entrada insuficiente. M√≠nimo: ${entradaMinima}`);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Entrada insuficiente. Necess√°rio pelo menos ${formatarMoeda(entradaMinima)} (${maxFinanciamento}% m√°x. financiamento para im√≥vel ${tipoImovelAtual})`,
                    entradaMinima: entradaMinima,
                    mcmv: elegibilidadeMcmv.elegivel,
                    subsidio: subsidio,
                    tipoImovel: tipoImovelAtual
                };
            }

            // Calcular presta√ß√£o com o prazo escolhido
            const taxaMensal = taxa / 100 / 12;
            
            let prestacao;
            if (sistemaAtual === 'SAC') {
                prestacao = calcularSAC(valorFinanciar, taxaMensal, prazoMeses);
            } else {
                prestacao = calcularPRICE(valorFinanciar, taxaMensal, prazoMeses);
            }

            debugLog(`Presta√ß√£o ${sistemaAtual}: ${prestacao.toFixed(2)}`);

            // Verificar capacidade de pagamento (30% da renda)
            const maxPrestacao = rendaFamiliar * 0.3;
            debugLog(`Capacidade: Presta√ß√£o=${prestacao.toFixed(2)} vs M√°x=${maxPrestacao.toFixed(2)}`);
            
            if (prestacao > maxPrestacao) {
                debugLog(`REPROVADO: Presta√ß√£o acima da capacidade`);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Renda insuficiente. Presta√ß√£o seria ${formatarMoeda(prestacao)}, m√°ximo permitido: ${formatarMoeda(maxPrestacao)} (30% da renda)`,
                    prestacao: prestacao,
                    maxPrestacao: maxPrestacao,
                    mcmv: elegibilidadeMcmv.elegivel,
                    subsidio: subsidio,
                    tipoImovel: tipoImovelAtual
                };
            }

            // Calcular totais
            const totalPago = prestacao * prazoMeses + valorEntrada;
            const jurosTotal = totalPago - valorImovel;
            const prazoAnos = prazoMeses / 12;

            debugLog(`APROVADO: Presta√ß√£o=${prestacao.toFixed(2)}, Total=${totalPago.toFixed(2)}`);

            return {
                banco: banco.nome,
                aprovado: true,
                valorImovel: valorImovel,
                valorEntrada: valorEntrada,
                valorFinanciar: valorFinanciar,
                prestacao: prestacao,
                prazoAnos: prazoAnos,
                prazoMeses: prazoMeses,
                taxa: taxa,
                totalPago: totalPago,
                jurosTotal: jurosTotal,
                sistema: sistemaAtual,
                mcmv: elegibilidadeMcmv.elegivel,
                subsidio: subsidio,
                percentualRenda: (prestacao / rendaFamiliar) * 100,
                tipoImovel: tipoImovelAtual,
                beneficioJovem: beneficioJovem,
                idade: idade
            };
        }<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Simulador Inteligente - Financiamento Imobili√°rio 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: flex;
            align-items: center;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1rem;
        }

        .tooltip {
            background: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 8px;
            cursor: help;
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .input-wrapper {
            position: relative;
        }

        .form-group input[type="text"] {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
            text-align: right;
        }

        .form-group input[type="text"]:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            outline: none;
        }

        .slider-container {
            margin-top: 15px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            -webkit-appearance: none;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa502, #2ed573);
            transition: all 0.3s ease;
            border-radius: 4px;
            width: 0%;
        }

        .banks-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .banks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .bank-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .bank-option:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
        }

        .bank-option.selected {
            border-color: #4CAF50;
            background: #f0f9f0;
        }

        .bank-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .bank-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .bank-details {
            font-size: 0.9rem;
            color: #666;
        }

        .system-toggle {
            display: flex;
            background: #e9ecef;
            border-radius: 25px;
            padding: 4px;
            margin-top: 15px;
        }

        .system-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .system-toggle button.active {
            background: #4CAF50;
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .tipo-imovel-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tipo-imovel-btn.active {
            background: #4CAF50;
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .sistema-explicacao {
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #e9ecef;
        }

        .explicacao-sac,
        .explicacao-price {
            display: none;
        }

        .explicacao-sac.active,
        .explicacao-price.active {
            display: block;
        }

        .explicacao-detalhes h4 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .explicacao-detalhes p {
            margin-bottom: 10px;
            color: #555;
            line-height: 1.5;
        }

        .vantagens-desvantagens {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 15px 0;
        }

        .vantagens,
        .desvantagens {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .desvantagens {
            border-left-color: #ff6b6b;
        }

        .vantagens h5,
        .desvantagens h5 {
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .vantagens ul,
        .desvantagens ul {
            margin: 0;
            padding-left: 20px;
        }

        .vantagens li,
        .desvantagens li {
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #666;
        }

        .ideal-para {
            background: #e8f5e8;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            font-style: italic;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
            color: #333;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #bee5eb;
        }

        .comparator {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .comparator-header {
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        .debug-info {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            display: none;
        }

        .debug-toggle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .banks-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Simulador Inteligente</h1>
            <p>Financiamento Imobili√°rio 2025 - Compare e escolha a melhor op√ß√£o</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2>üìã Dados da Simula√ß√£o</h2>
                
                <div class="form-group">
                    <label for="valorImovel">
                        Valor do Im√≥vel
                        <span class="tooltip" data-tooltip="Valor total do im√≥vel que voc√™ deseja financiar">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="valorImovel" placeholder="Ex: 500.000,00" value="500.000,00">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderImovel" min="100000" max="2000000" step="10000" value="500000">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="valorEntrada">
                        Valor da Entrada
                        <span class="tooltip" data-tooltip="Valor que voc√™ tem dispon√≠vel para dar de entrada">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="valorEntrada" placeholder="Ex: 100.000,00" value="100.000,00">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderEntrada" min="0" max="500000" step="5000" value="100000">
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressEntrada"></div>
                        </div>
                        <small id="percentualEntrada">20.0% do valor do im√≥vel</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="rendaFamiliar">
                        Renda Familiar Bruta
                        <span class="tooltip" data-tooltip="Soma de todas as rendas comprovadas da fam√≠lia">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="text" id="rendaFamiliar" placeholder="Ex: 12.000,00" value="12.000,00">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderRenda" min="1000" max="50000" step="500" value="12000">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="dataNascimento">
                        Data de Nascimento
                        <span class="tooltip" data-tooltip="Necess√°ria para calcular idade e verificar programas especiais para jovens">?</span>
                    </label>
                    <input type="date" id="dataNascimento" style="width: 100%; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1.1rem; background: white;">
                </div>

                <div class="form-group">
                    <label>Tipo de Im√≥vel</label>
                    <div class="system-toggle">
                        <button type="button" class="tipo-imovel-btn active" data-tipo="novo">
                            Novo <span class="tooltip" data-tooltip="Im√≥veis novos t√™m taxas menores e financiamento at√© 90%">?</span>
                        </button>
                        <button type="button" class="tipo-imovel-btn" data-tipo="usado">
                            Usado <span class="tooltip" data-tooltip="Im√≥veis usados t√™m financiamento at√© 80% do valor">?</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prazoFinanciamento">
                        Prazo do Financiamento
                        <span class="tooltip" data-tooltip="Tempo para quita√ß√£o completa do financiamento">?</span>
                    </label>
                    <div class="input-wrapper">
                        <select id="prazoFinanciamento" style="width: 100%; padding: 15px 20px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1.1rem; background: white;">
                            <option value="180">15 anos (180 parcelas)</option>
                            <option value="240">20 anos (240 parcelas)</option>
                            <option value="300">25 anos (300 parcelas)</option>
                            <option value="360" selected>30 anos (360 parcelas)</option>
                            <option value="420">35 anos (420 parcelas)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Sistema de Amortiza√ß√£o</label>
                    <div class="system-toggle">
                        <button type="button" class="system-btn active" data-system="SAC">
                            SAC
                        </button>
                        <button type="button" class="system-btn" data-system="PRICE">
                            PRICE
                        </button>
                    </div>
                    <div class="sistema-explicacao" id="explicacaoSistema">
                        <div class="explicacao-sac active">
                            <h4>üìâ Sistema SAC (Amortiza√ß√£o Constante)</h4>
                            <div class="explicacao-detalhes">
                                <p><strong>Como funciona:</strong> Parcelas come√ßam altas e diminuem mensalmente.</p>
                                <p><strong>Amortiza√ß√£o:</strong> Valor fixo todo m√™s, reduzindo o saldo devedor rapidamente.</p>
                                <p><strong>Juros:</strong> Calculados sobre saldo devedor decrescente.</p>
                                <div class="vantagens-desvantagens">
                                    <div class="vantagens">
                                        <h5>‚úÖ Vantagens:</h5>
                                        <ul>
                                            <li>Menor valor total de juros</li>
                                            <li>Saldo devedor cai rapidamente</li>
                                            <li>Presta√ß√µes diminuem com o tempo</li>
                                        </ul>
                                    </div>
                                    <div class="desvantagens">
                                        <h5>‚ö†Ô∏è Desvantagens:</h5>
                                        <ul>
                                            <li>Parcelas iniciais mais altas</li>
                                            <li>Maior comprometimento inicial da renda</li>
                                        </ul>
                                    </div>
                                </div>
                                <p class="ideal-para"><strong>üí° Ideal para:</strong> Quem tem renda est√°vel e quer pagar menos juros no total.</p>
                            </div>
                        </div>
                        <div class="explicacao-price">
                            <h4>üìä Sistema PRICE (Presta√ß√µes Fixas)</h4>
                            <div class="explicacao-detalhes">
                                <p><strong>Como funciona:</strong> Parcelas fixas durante todo o financiamento.</p>
                                <p><strong>Amortiza√ß√£o:</strong> Come√ßa baixa e aumenta ao longo do tempo.</p>
                                <p><strong>Juros:</strong> Maior no in√≠cio, menor no final.</p>
                                <div class="vantagens-desvantagens">
                                    <div class="vantagens">
                                        <h5>‚úÖ Vantagens:</h5>
                                        <ul>
                                            <li>Parcelas fixas facilitam planejamento</li>
                                            <li>Comprometimento inicial menor</li>
                                            <li>Mais f√°cil de ser aprovado</li>
                                        </ul>
                                    </div>
                                    <div class="desvantagens">
                                        <h5>‚ö†Ô∏è Desvantagens:</h5>
                                        <ul>
                                            <li>Maior valor total de juros</li>
                                            <li>Saldo devedor cai lentamente</li>
                                        </ul>
                                    </div>
                                </div>
                                <p class="ideal-para"><strong>üí° Ideal para:</strong> Quem prefere previsibilidade e tem or√ßamento apertado inicialmente.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="debug-toggle" onclick="toggleDebug()">üêõ Mostrar Debug</button>
            </div>

            <div class="banks-section">
                <h2>üè¶ Escolha os Bancos</h2>
                <p>Selecione um ou mais bancos para comparar as condi√ß√µes</p>
                
                <div class="banks-grid">
                    <div class="bank-option" data-bank="caixa">
                        <input type="checkbox" id="banco_caixa" name="banco" value="caixa">
                        <div class="bank-name">üèõÔ∏è Caixa Econ√¥mica Federal</div>
                        <div class="bank-details">
                            Taxa: 8,16% a.a + TR<br>
                            MCMV dispon√≠vel<br>
                            At√© 90% financiamento
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bb">
                        <input type="checkbox" id="banco_bb" name="banco" value="bb">
                        <div class="bank-name">üü° Banco do Brasil</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bradesco">
                        <input type="checkbox" id="banco_bradesco" name="banco" value="bradesco">
                        <div class="bank-name">üî¥ Bradesco</div>
                        <div class="bank-details">
                            Taxa: 9,75% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Relacionamento banc√°rio
                        </div>
                    </div>

                    <div class="bank-option" data-bank="santander">
                        <input type="checkbox" id="banco_santander" name="banco" value="santander">
                        <div class="bank-name">üî∫ Santander</div>
                        <div class="bank-details">
                            Taxa: 9,49% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Condi√ß√µes especiais
                        </div>
                    </div>

                    <div class="bank-option" data-bank="itau">
                        <input type="checkbox" id="banco_itau" name="banco" value="itau">
                        <div class="bank-name">üü† Ita√∫</div>
                        <div class="bank-details">
                            Taxa: 9,89% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="inter">
                        <input type="checkbox" id="banco_inter" name="banco" value="inter">
                        <div class="bank-name">üüß Banco Inter</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            100% digital<br>
                            Processo simplificado
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" id="calcularBtn">
                    üìä Calcular Financiamento
                </button>
            </div>

            <div class="debug-info" id="debugInfo"></div>

            <div class="results-section hidden" id="resultsSection">
                <h2>üìà Resultados da Simula√ß√£o</h2>
                <div id="alertsContainer"></div>
                <div class="results-grid" id="resultsGrid"></div>
                
                <div class="comparator hidden" id="comparator">
                    <div class="comparator-header">
                        üîç Comparativo Detalhado
                    </div>
                    <table class="comparison-table" id="comparisonTable">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Iniciando Calculadora de Financiamento v2.0');
        
        // Configura√ß√µes dos bancos com dados corretos
        const bancosConfig = {
            caixa: {
                nome: "Caixa Econ√¥mica Federal",
                taxa: 8.16,
                maxFinanciamento: 90, // MCMV permite at√© 90%
                mcmv: true,
                limiteMcmv: 350000,
                subsidioMcmv: 47500,
                taxaMcmv: 5.95
            },
            bb: {
                nome: "Banco do Brasil",
                taxa: 8.99,
                maxFinanciamento: 80,
                mcmv: false
            },
            bradesco: {
                nome: "Bradesco",
                taxa: 9.75,
                maxFinanciamento: 80,
                mcmv: false
            },
            santander: {
                nome: "Santander",
                taxa: 9.49,
                maxFinanciamento: 80,
                mcmv: false
            },
            itau: {
                nome: "Ita√∫",
                taxa: 9.89,
                maxFinanciamento: 80,
                mcmv: false
            },
            inter: {
                nome: "Banco Inter",
                taxa: 8.99,
                maxFinanciamento: 80,
                mcmv: false
            }
        };

        let sistemaAtual = 'SAC';
        let tipoImovelAtual = 'novo';
        let debugMode = false;

        function debugLog(message) {
            console.log('üêõ DEBUG:', message);
            if (debugMode) {
                const debugDiv = document.getElementById('debugInfo');
                debugDiv.innerHTML += message + '<br>';
                debugDiv.style.display = 'block';
            }
        }

        function toggleDebug() {
            debugMode = !debugMode;
            const debugDiv = document.getElementById('debugInfo');
            const button = document.querySelector('.debug-toggle');
            
            if (debugMode) {
                debugDiv.style.display = 'block';
                button.textContent = 'üêõ Ocultar Debug';
                debugDiv.innerHTML = '=== DEBUG MODE ATIVADO ===<br>';
            } else {
                debugDiv.style.display = 'none';
                button.textContent = 'üêõ Mostrar Debug';
            }
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('DOM carregado, iniciando configura√ß√µes...');
            
            // Garantir que todos os checkboxes iniciem desmarcados
            document.querySelectorAll('input[type="checkbox"][name="banco"]').forEach(cb => {
                cb.checked = false;
                debugLog(`Checkbox ${cb.value} desmarcado: ${!cb.checked}`);
            });

            // Configurar data inicial (30 anos atr√°s)
            const hoje = new Date();
            const dataInicial = new Date(hoje.getFullYear() - 30, hoje.getMonth(), hoje.getDate());
            document.getElementById('dataNascimento').value = dataInicial.toISOString().split('T')[0];

            // Configurar sliders
            setupSliders();
            
            // Configurar eventos dos bancos
            setupBankSelection();
            
            // Configurar sistema de amortiza√ß√£o
            setupSystemToggle();

            // Configurar tipo de im√≥vel
            setupTipoImovel();

            // Configurar bot√£o de c√°lculo
            document.getElementById('calcularBtn').addEventListener('click', calcularFinanciamento);

            // Atualizar progresso inicial
            updateProgress();
            
            debugLog('Setup conclu√≠do com sucesso!');
        });

        function setupSliders() {
            debugLog('Configurando sliders...');
            
            const valorImovel = document.getElementById('valorImovel');
            const sliderImovel = document.getElementById('sliderImovel');
            const valorEntrada = document.getElementById('valorEntrada');
            const sliderEntrada = document.getElementById('sliderEntrada');
            const rendaFamiliar = document.getElementById('rendaFamiliar');
            const sliderRenda = document.getElementById('sliderRenda');

            // Configurar formata√ß√£o autom√°tica dos campos
            setupCurrencyInput(valorImovel);
            setupCurrencyInput(valorEntrada);
            setupCurrencyInput(rendaFamiliar);

            // Sincronizar input do im√≥vel com slider
            valorImovel.addEventListener('input', function() {
                const valor = parseFloat(this.value.replace(/\./g, '').replace(',', '.')) || 0;
                sliderImovel.value = valor;
                updateProgress();
                updateSliderEntradaMax();
                debugLog(`Valor im√≥vel alterado: ${valor}`);
            });

            sliderImovel.addEventListener('input', function() {
                const valor = parseFloat(this.value);
                valorImovel.value = formatarMoedaBrasil(valor);
                updateProgress();
                updateSliderEntradaMax();
                debugLog(`Slider im√≥vel alterado: ${valor}`);
            });

            // Sincronizar input da entrada com slider
            valorEntrada.addEventListener('input', function() {
                const valor = parseFloat(this.value.replace(/\./g, '').replace(',', '.')) || 0;
                sliderEntrada.value = valor;
                updateProgress();
                debugLog(`Valor entrada alterado: ${valor}`);
            });

            sliderEntrada.addEventListener('input', function() {
                const valor = parseFloat(this.value);
                valorEntrada.value = formatarMoedaBrasil(valor);
                updateProgress();
                debugLog(`Slider entrada alterado: ${valor}`);
            });

            // Sincronizar input da renda com slider
            rendaFamiliar.addEventListener('input', function() {
                const valor = parseFloat(this.value.replace(/\./g, '').replace(',', '.')) || 0;
                sliderRenda.value = valor;
                debugLog(`Renda alterada: ${valor}`);
            });

            sliderRenda.addEventListener('input', function() {
                const valor = parseFloat(this.value);
                rendaFamiliar.value = formatarMoedaBrasil(valor);
                debugLog(`Slider renda alterado: ${valor}`);
            });
        }

        function setupCurrencyInput(input) {
            // Formata√ß√£o autom√°tica durante digita√ß√£o
            input.addEventListener('input', function(e) {
                let valor = e.target.value;
                
                // Remove tudo exceto n√∫meros
                valor = valor.replace(/[^\d]/g, '');
                
                // Se campo vazio, deixa vazio
                if (!valor) {
                    e.target.value = '';
                    return;
                }
                
                // Converte para n√∫mero e formata
                const numero = parseInt(valor);
                e.target.value = formatarMoedaBrasil(numero);
            });

            // Formata√ß√£o ao sair do campo
            input.addEventListener('blur', function(e) {
                if (!e.target.value) {
                    e.target.value = '';
                    return;
                }
                
                const valor = obterValorNumerico(e.target.id);
                if (valor > 0) {
                    e.target.value = formatarMoedaBrasil(valor);
                }
            });

            // Permitir sele√ß√£o completa com Ctrl+A
            input.addEventListener('keydown', function(e) {
                // Permitir Ctrl+A, Ctrl+C, Ctrl+V, Delete, Backspace, Tab, Enter, Esc
                if (e.ctrlKey || e.key === 'Delete' || e.key === 'Backspace' || 
                    e.key === 'Tab' || e.key === 'Enter' || e.key === 'Escape' ||
                    e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    return;
                }
                
                // Permitir apenas n√∫meros
                if (!/^\d$/.test(e.key)) {
                    e.preventDefault();
                }
            });

            // Limpar campo ao focar se estiver vazio ou com zero
            input.addEventListener('focus', function(e) {
                const valor = obterValorNumerico(e.target.id);
                if (valor === 0) {
                    e.target.value = '';
                }
            });
        }

        function formatarMoedaBrasil(valor) {
            if (isNaN(valor) || valor === 0) return '';
            
            return new Intl.NumberFormat('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(valor);
        }

        function obterValorNumerico(inputId) {
            const valor = document.getElementById(inputId).value;
            if (!valor) return 0;
            
            // Remove pontos e substitui v√≠rgula por ponto
            const numeroLimpo = valor.replace(/\./g, '').replace(',', '.');
            return parseFloat(numeroLimpo) || 0;
        }

        function updateSliderEntradaMax() {
            const valorImovel = obterValorNumerico('valorImovel');
            const sliderEntrada = document.getElementById('sliderEntrada');
            sliderEntrada.max = valorImovel;
            debugLog(`M√°ximo do slider entrada atualizado: ${valorImovel}`);
        }

        function updateProgress() {
            const valorImovel = obterValorNumerico('valorImovel');
            const valorEntrada = obterValorNumerico('valorEntrada');
            
            if (valorImovel > 0) {
                const percentual = (valorEntrada / valorImovel) * 100;
                const progressFill = document.getElementById('progressEntrada');
                const percentualText = document.getElementById('percentualEntrada');
                
                progressFill.style.width = Math.min(percentual, 100) + '%';
                percentualText.textContent = `${percentual.toFixed(1)}% do valor do im√≥vel`;
                
                // Colorir baseado no percentual
                if (percentual < 20) {
                    progressFill.style.background = '#ff4757';
                } else if (percentual < 30) {
                    progressFill.style.background = '#ffa502';
                } else {
                    progressFill.style.background = '#2ed573';
                }
                
                debugLog(`Progresso atualizado: ${percentual.toFixed(1)}%`);
            }
        }

        function setupBankSelection() {
            debugLog('Configurando sele√ß√£o de bancos...');
            
            document.querySelectorAll('.bank-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    // Evitar duplo clique
                    if (e.target.type === 'checkbox') return;
                    
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        this.classList.add('selected');
                        debugLog(`‚úÖ Banco ${checkbox.value} selecionado`);
                    } else {
                        this.classList.remove('selected');
                        debugLog(`‚ùå Banco ${checkbox.value} desmarcado`);
                    }
                });
            });
        }

        function setupSystemToggle() {
            debugLog('Configurando sistema de amortiza√ß√£o...');
            
            document.querySelectorAll('.system-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.system-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    sistemaAtual = this.dataset.system;
                    
                    // Atualizar explica√ß√£o
                    document.querySelectorAll('.explicacao-sac, .explicacao-price').forEach(exp => {
                        exp.classList.remove('active');
                    });
                    
                    if (sistemaAtual === 'SAC') {
                        document.querySelector('.explicacao-sac').classList.add('active');
                    } else {
                        document.querySelector('.explicacao-price').classList.add('active');
                    }
                    
                    debugLog(`Sistema alterado para: ${sistemaAtual}`);
                });
            });
        }

        function setupTipoImovel() {
            debugLog('Configurando tipo de im√≥vel...');
            
            document.querySelectorAll('.tipo-imovel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tipo-imovel-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    tipoImovelAtual = this.dataset.tipo;
                    debugLog(`Tipo de im√≥vel alterado para: ${tipoImovelAtual}`);
                });
            });
        }

        function calcularIdade() {
            const dataNascimento = document.getElementById('dataNascimento').value;
            if (!dataNascimento) return 0;
            
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            
            return idade;
        }

        function calcularFinanciamento() {
            debugLog('üßÆ INICIANDO C√ÅLCULO DE FINANCIAMENTO');
            
            const valorImovel = obterValorNumerico('valorImovel');
            const valorEntrada = obterValorNumerico('valorEntrada');
            const rendaFamiliar = obterValorNumerico('rendaFamiliar');
            const prazoMeses = parseInt(document.getElementById('prazoFinanciamento').value);
            const idade = calcularIdade();
            
            debugLog(`Dados: Im√≥vel=${valorImovel}, Entrada=${valorEntrada}, Renda=${rendaFamiliar}, Prazo=${prazoMeses}meses, Sistema=${sistemaAtual}, Tipo=${tipoImovelAtual}, Idade=${idade}`);
            
            // Valida√ß√µes b√°sicas
            if (!valorImovel || valorImovel <= 0) {
                showAlert('‚ùå Informe o valor do im√≥vel.', 'danger');
                debugLog('ERRO: Valor do im√≥vel inv√°lido');
                return;
            }

            if (valorEntrada < 0) {
                showAlert('‚ùå Informe o valor da entrada.', 'danger');
                debugLog('ERRO: Valor da entrada inv√°lido');
                return;
            }

            if (!rendaFamiliar || rendaFamiliar <= 0) {
                showAlert('‚ùå Informe a renda familiar.', 'danger');
                debugLog('ERRO: Renda familiar inv√°lida');
                return;
            }

            if (!document.getElementById('dataNascimento').value) {
                showAlert('‚ùå Informe a data de nascimento.', 'danger');
                debugLog('ERRO: Data de nascimento n√£o informada');
                return;
            }

            // Valida√ß√£o de idade + prazo
            const idadeFinalFinanciamento = idade + (prazoMeses / 12);
            if (idadeFinalFinanciamento > 80) {
                const prazoMaximo = (80 - idade) * 12;
                showAlert(`‚ö†Ô∏è Prazo muito longo! Com sua idade (${idade} anos), o prazo m√°ximo √© ${Math.floor(prazoMaximo)} meses.`, 'warning');
                debugLog(`ERRO: Idade final seria ${idadeFinalFinanciamento} anos`);
                return;
            }

            if (valorEntrada >= valorImovel) {
                showAlert('‚ùå O valor da entrada n√£o pode ser maior ou igual ao valor do im√≥vel.', 'danger');
                debugLog('ERRO: Entrada maior que valor do im√≥vel');
                return;
            }

            // Verificar bancos selecionados
            const bancosSelecionados = Array.from(document.querySelectorAll('input[name="banco"]:checked'))
                .map(cb => cb.value);

            debugLog(`Bancos selecionados: ${bancosSelecionados.join(', ')}`);

            if (bancosSelecionados.length === 0) {
                showAlert('‚ö†Ô∏è Selecione pelo menos um banco para simular.', 'warning');
                debugLog('ERRO: Nenhum banco selecionado');
                return;
            }

            // Limpar alertas anteriores
            document.getElementById('alertsContainer').innerHTML = '';

            // Calcular para cada banco
            const resultados = [];
            bancosSelecionados.forEach(bancoCodigo => {
                debugLog(`--- Calculando para ${bancoCodigo.toUpperCase()} ---`);
                const resultado = calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar, prazoMeses, idade);
                if (resultado) {
                    resultados.push(resultado);
                    debugLog(`Resultado ${bancoCodigo}: ${resultado.aprovado ? 'APROVADO' : 'REPROVADO'} - ${resultado.motivo || 'OK'}`);
                }
            });

            debugLog(`Total de resultados: ${resultados.length}`);
            
            // Exibir resultados
            exibirResultados(resultados);
        }

        function calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar) {
            const banco = bancosConfig[bancoCodigo];
            let valorFinanciar = valorImovel - valorEntrada;
            
            debugLog(`${banco.nome}: Valor inicial a financiar = ${valorFinanciar}`);
            
            // Verificar se √© eleg√≠vel para MCMV
            const elegibilidadeMcmv = verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar);
            debugLog(`MCMV: ${elegibilidadeMcmv.elegivel ? 'Eleg√≠vel' : elegibilidadeMcmv.motivo}`);
            
            let taxa = banco.taxa;
            let subsidio = 0;
            
            if (elegibilidadeMcmv.elegivel) {
                taxa = banco.taxaMcmv || banco.taxa;
                subsidio = banco.subsidioMcmv || 0;
                valorFinanciar = Math.max(0, valorFinanciar - subsidio);
                debugLog(`MCMV aplicado: Taxa=${taxa}%, Subs√≠dio=${subsidio}, Valor final=${valorFinanciar}`);
            }

            // Verificar percentual m√°ximo de financiamento
            const percentualFinanciamento = (valorFinanciar / valorImovel) * 100;
            const maxPermitido = elegibilidadeMcmv.elegivel ? 90 : banco.maxFinanciamento;
            
            debugLog(`Percentual financiamento: ${percentualFinanciamento.toFixed(1)}% (M√°x: ${maxPermitido}%)`);
            
            if (percentualFinanciamento > maxPermitido) {
                const entradaMinima = valorImovel * (1 - maxPermitido / 100);
                debugLog(`REPROVADO: Entrada insuficiente. M√≠nimo: ${entradaMinima}`);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Entrada insuficiente. Necess√°rio pelo menos ${formatarMoeda(entradaMinima)} (${maxPermitido}% m√°x. financiamento)`,
                    entradaMinima: entradaMinima,
                    mcmv: elegibilidadeMcmv.elegivel,
                    subsidio: subsidio
                };
            }

            // Calcular presta√ß√£o
            const prazoMeses = 360; // 30 anos
            const taxaMensal = taxa / 100 / 12;
            
            let prestacao;
            if (sistemaAtual === 'SAC') {
                prestacao = calcularSAC(valorFinanciar, taxaMensal, prazoMeses);
            } else {
                prestacao = calcularPRICE(valorFinanciar, taxaMensal, prazoMeses);
            }

            debugLog(`Presta√ß√£o ${sistemaAtual}: ${prestacao.toFixed(2)}`);

            // Verificar capacidade de pagamento (30% da renda)
            const maxPrestacao = rendaFamiliar * 0.3;
            debugLog(`Capacidade: Presta√ß√£o=${prestacao.toFixed(2)} vs M√°x=${maxPrestacao.toFixed(2)}`);
            
            if (prestacao > maxPrestacao) {
                debugLog(`REPROVADO: Presta√ß√£o acima da capacidade`);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Renda insuficiente. Presta√ß√£o seria ${formatarMoeda(prestacao)}, m√°ximo permitido: ${formatarMoeda(maxPrestacao)} (30% da renda)`,
                    prestacao: prestacao,
                    maxPrestacao: maxPrestacao,
                    mcmv: elegibilidadeMcmv.elegivel,
                    subsidio: subsidio
                };
            }

            // Calcular totais
            const totalPago = prestacao * prazoMeses + valorEntrada;
            const jurosTotal = totalPago - valorImovel;

            debugLog(`APROVADO: Presta√ß√£o=${prestacao.toFixed(2)}, Total=${totalPago.toFixed(2)}`);

            return {
                banco: banco.nome,
                aprovado: true,
                valorImovel: valorImovel,
                valorEntrada: valorEntrada,
                valorFinanciar: valorFinanciar,
                prestacao: prestacao,
                prazoAnos: 30,
                taxa: taxa,
                totalPago: totalPago,
                jurosTotal: jurosTotal,
                sistema: sistemaAtual,
                mcmv: elegibilidadeMcmv.elegivel,
                subsidio: subsidio,
                percentualRenda: (prestacao / rendaFamiliar) * 100
            };
        }

        function verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar) {
            const banco = bancosConfig[bancoCodigo];
            
            if (!banco.mcmv) {
                return { elegivel: false, motivo: 'Banco n√£o oferece MCMV' };
            }

            // Limites do MCMV Classe M√©dia (2025)
            if (rendaFamiliar < 2400 || rendaFamiliar > 8000) {
                return { elegivel: false, motivo: 'Renda fora da faixa MCMV (R$ 2.400 - R$ 8.000)' };
            }

            if (valorImovel > 350000) {
                return { elegivel: false, motivo: 'Valor do im√≥vel acima do limite MCMV (R$ 350.000)' };
            }

            return { elegivel: true, motivo: 'Eleg√≠vel para MCMV' };
        }

        function calcularSAC(valor, taxaMensal, prazoMeses) {
            const amortizacao = valor / prazoMeses;
            const jurosPrimeiraParcela = valor * taxaMensal;
            return amortizacao + jurosPrimeiraParcela; // Primeira parcela (maior)
        }

        function calcularPRICE(valor, taxaMensal, prazoMeses) {
            if (taxaMensal === 0) return valor / prazoMeses;
            return valor * (taxaMensal * Math.pow(1 + taxaMensal, prazoMeses)) / (Math.pow(1 + taxaMensal, prazoMeses) - 1);
        }

        function exibirResultados(resultados) {
            debugLog('üìä Exibindo resultados...');
            
            const resultsSection = document.getElementById('resultsSection');
            const alertsContainer = document.getElementById('alertsContainer');
            const resultsGrid = document.getElementById('resultsGrid');
            const comparator = document.getElementById('comparator');
            
            // Limpar resultados anteriores
            alertsContainer.innerHTML = '';
            resultsGrid.innerHTML = '';
            
            // Separar aprovados e reprovados
            const aprovados = resultados.filter(r => r.aprovado);
            const reprovados = resultados.filter(r => !r.aprovado);

            debugLog(`Aprovados: ${aprovados.length}, Reprovados: ${reprovados.length}`);

            // Mostrar alertas para reprovados
            reprovados.forEach(resultado => {
                showAlert(`‚ùå ${resultado.banco}: ${resultado.motivo}`, 'danger');
                debugLog(`Alerta reprova√ß√£o: ${resultado.banco}`);
            });

            if (aprovados.length === 0) {
                showAlert('‚ùå Nenhuma simula√ß√£o foi aprovada. Verifique os valores informados ou considere aumentar a entrada/renda.', 'warning');
                resultsSection.classList.remove('hidden');
                comparator.classList.add('hidden');
                debugLog('Nenhum resultado aprovado');
                return;
            }

            // Mostrar sucesso
            showAlert(`‚úÖ ${aprovados.length} banco(s) aprovaram o financiamento!`, 'success');

            // Ordenar por menor presta√ß√£o
            aprovados.sort((a, b) => a.prestacao - b.prestacao);
            debugLog(`Ordena√ß√£o por presta√ß√£o: ${aprovados.map(a => `${a.banco}:${a.prestacao.toFixed(2)}`).join(', ')}`);

            // Exibir cards dos resultados
            aprovados.forEach((resultado, index) => {
                const card = criarCardResultado(resultado, index === 0);
                resultsGrid.appendChild(card);
            });

            // Exibir comparativo se houver mais de um aprovado
            if (aprovados.length > 1) {
                criarComparativo(aprovados);
                comparator.classList.remove('hidden');
                debugLog('Comparativo exibido');
            } else {
                comparator.classList.add('hidden');
                debugLog('Comparativo oculto (apenas 1 resultado)');
            }

            resultsSection.classList.remove('hidden');
            adicionarBotoesAcao();
            
            // Scroll suave para resultados
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function criarCardResultado(resultado, melhorOpcao) {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            if (melhorOpcao) {
                card.style.borderLeftColor = '#4CAF50';
                card.style.borderLeftWidth = '6px';
                card.style.background = '#f8fff8';
            }

            const badge = resultado.mcmv ? 
                '<span style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 10px; font-weight: 600;">MCMV</span>' : 
                '';
            
            const melhorBadge = melhorOpcao ? 
                '<span style="background: #FFD700; color: #333; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 10px; font-weight: 600;">‚≠ê MELHOR OP√á√ÉO</span>' : 
                '';

            card.innerHTML = `
                <h3>${resultado.banco}${badge}${melhorBadge}</h3>
                
                <div class="result-item">
                    <span class="result-label">üí∞ Presta√ß√£o ${resultado.sistema}:</span>
                    <span class="result-value" style="color: #4CAF50; font-size: 1.3em; font-weight: 700;">${formatarMoeda(resultado.prestacao)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üìä % da Renda:</span>
                    <span class="result-value" style="color: ${resultado.percentualRenda > 25 ? '#ff6b6b' : '#4CAF50'};">${resultado.percentualRenda.toFixed(1)}%</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üè† Valor Financiado:</span>
                    <span class="result-value">${formatarMoeda(resultado.valorFinanciar)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üìà Taxa de Juros:</span>
                    <span class="result-value">${resultado.taxa.toFixed(2)}% a.a + TR</span>
                </div>
                
                ${resultado.subsidio > 0 ? `
                <div class="result-item">
                    <span class="result-label">üéÅ Subs√≠dio MCMV:</span>
                    <span class="result-value" style="color: #4CAF50; font-weight: 700;">-${formatarMoeda(resultado.subsidio)}</span>
                </div>
                ` : ''}
                
                <div class="result-item">
                    <span class="result-label">üí∏ Total de Juros:</span>
                    <span class="result-value" style="color: #ff6b6b;">${formatarMoeda(resultado.jurosTotal)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üí∞ Total Pago:</span>
                    <span class="result-value" style="font-weight: 700;">${formatarMoeda(resultado.totalPago)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">‚è∞ Prazo:</span>
                    <span class="result-value">${resultado.prazoAnos} anos (${resultado.prazoAnos * 12} parcelas)</span>
                </div>
            `;

            return card;
        }

        function criarComparativo(resultados) {
            const table = document.getElementById('comparisonTable');
            const thead = table.querySelector('thead');
            const tbody = table.querySelector('tbody');
            
            // Limpar tabela
            thead.innerHTML = '';
            tbody.innerHTML = '';

            // Criar cabe√ßalho
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th style="min-width: 150px;">Crit√©rio</th>
                ${resultados.map(r => `<th style="text-align: center;">${r.banco}</th>`).join('')}
            `;
            thead.appendChild(headerRow);

            // Dados para compara√ß√£o
            const comparacoes = [
                {
                    label: 'üí∞ Presta√ß√£o',
                    values: resultados.map(r => formatarMoeda(r.prestacao)),
                    highlight: (values, r) => r.prestacao === Math.min(...resultados.map(res => res.prestacao))
                },
                {
                    label: 'üìä % da Renda',
                    values: resultados.map(r => r.percentualRenda.toFixed(1) + '%'),
                    highlight: (values, r) => r.percentualRenda === Math.min(...resultados.map(res => res.percentualRenda))
                },
                {
                    label: 'üìà Taxa de Juros',
                    values: resultados.map(r => r.taxa.toFixed(2) + '% a.a'),
                    highlight: (values, r) => r.taxa === Math.min(...resultados.map(res => res.taxa))
                },
                {
                    label: 'üí∏ Total de Juros',
                    values: resultados.map(r => formatarMoeda(r.jurosTotal)),
                    highlight: (values, r) => r.jurosTotal === Math.min(...resultados.map(res => res.jurosTotal))
                },
                {
                    label: 'üí∞ Total Pago',
                    values: resultados.map(r => formatarMoeda(r.totalPago)),
                    highlight: (values, r) => r.totalPago === Math.min(...resultados.map(res => res.totalPago))
                },
                {
                    label: 'üè† MCMV',
                    values: resultados.map(r => r.mcmv ? '‚úÖ Sim' : '‚ùå N√£o'),
                    highlight: (values, r) => r.mcmv
                },
                {
                    label: 'üîß Sistema',
                    values: resultados.map(r => r.sistema),
                    highlight: () => false
                }
            ];

            // Criar linhas da tabela
            comparacoes.forEach(comp => {
                const row = document.createElement('tr');
                let rowHTML = `<td style="font-weight: 600; background: #f8f9fa;">${comp.label}</td>`;
                
                resultados.forEach((resultado, index) => {
                    const isHighlight = comp.highlight ? comp.highlight(comp.values, resultado) : false;
                    const cellStyle = isHighlight ? 'background: #e8f5e8; font-weight: 700; color: #2e7d32;' : '';
                    rowHTML += `<td style="${cellStyle} text-align: center;">${comp.values[index]}</td>`;
                });
                
                row.innerHTML = rowHTML;
                tbody.appendChild(row);
            });
        }

        function showAlert(message, type = 'info') {
            const alertsContainer = document.getElementById('alertsContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            
            // Auto-remover ap√≥s 12 segundos
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 12000);
            
            alertsContainer.appendChild(alert);
            debugLog(`Alerta ${type}: ${message}`);
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(valor);
        }

        function adicionarBotoesAcao() {
            const resultsSection = document.getElementById('resultsSection');
            if (!document.getElementById('actionButtons')) {
                const actionDiv = document.createElement('div');
                actionDiv.id = 'actionButtons';
                actionDiv.style.cssText = 'margin-top: 25px; padding-top: 25px; border-top: 2px solid #e9ecef; text-align: center; gap: 15px; display: flex; flex-wrap: wrap; justify-content: center;';
                
                actionDiv.innerHTML = `
                    <button onclick="novaSimulacao()" style="background: linear-gradient(135deg, #28a745, #1e7e34); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
                        üîÑ Nova Simula√ß√£o
                    </button>
                    <button onclick="window.print()" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
                        üñ®Ô∏è Imprimir Resultado
                    </button>
                    <button onclick="copiarResultados()" style="background: linear-gradient(135deg, #17a2b8, #138496); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
                        üìã Copiar Resumo
                    </button>
                `;
                
                resultsSection.appendChild(actionDiv);

                // Adicionar efeitos hover
                actionDiv.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-2px)';
                        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
                    });
                    btn.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'none';
                    });
                });
            }
        }

        function novaSimulacao() {
            // Limpar campos mantendo valores padr√£o com formata√ß√£o
            document.getElementById('valorImovel').value = '500.000,00';
            document.getElementById('valorEntrada').value = '100.000,00';
            document.getElementById('rendaFamiliar').value = '12.000,00';
            
            // Resetar data de nascimento para 30 anos atr√°s
            const hoje = new Date();
            const dataInicial = new Date(hoje.getFullYear() - 30, hoje.getMonth(), hoje.getDate());
            document.getElementById('dataNascimento').value = dataInicial.toISOString().split('T')[0];
            
            // Resetar prazo para 30 anos
            document.getElementById('prazoFinanciamento').value = '360';
            
            // Resetar sliders
            document.getElementById('sliderImovel').value = '500000';
            document.getElementById('sliderEntrada').value = '100000';
            document.getElementById('sliderRenda').value = '12000';
            
            // Desmarcar bancos
            document.querySelectorAll('input[name="banco"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('.bank-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Resetar sistema para SAC
            document.querySelectorAll('.system-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.system-btn[data-system="SAC"]').classList.add('active');
            sistemaAtual = 'SAC';
            
            // Resetar tipo de im√≥vel para novo
            document.querySelectorAll('.tipo-imovel-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.tipo-imovel-btn[data-tipo="novo"]').classList.add('active');
            tipoImovelAtual = 'novo';
            
            // Resetar explica√ß√µes
            document.querySelectorAll('.explicacao-sac, .explicacao-price').forEach(exp => {
                exp.classList.remove('active');
            });
            document.querySelector('.explicacao-sac').classList.add('active');
            
            // Ocultar resultados
            document.getElementById('resultsSection').classList.add('hidden');
            
            // Limpar alertas e debug
            document.getElementById('alertsContainer').innerHTML = '';
            if (debugMode) {
                document.getElementById('debugInfo').innerHTML = '=== DEBUG MODE - Nova Simula√ß√£o ===<br>';
            }
            
            // Reset progress
            updateProgress();
            
            showAlert('üîÑ Simula√ß√£o resetada! Pronta para nova simula√ß√£o.', 'info');
            debugLog('Nova simula√ß√£o iniciada');
            
            // Scroll para o topo
            document.querySelector('.header').scrollIntoView({ behavior: 'smooth' });
        }

        function copiarResultados() {
            const aprovados = Array.from(document.querySelectorAll('.result-card')).map(card => {
                const banco = card.querySelector('h3').textContent;
                const prestacao = card.querySelector('.result-value').textContent;
                return `${banco}: ${prestacao}`;
            });
            
            const resumo = `üè† Simula√ß√£o Financiamento Imobili√°rio\n\n${aprovados.join('\n')}\n\nSimula√ß√£o realizada em ${new Date().toLocaleString('pt-BR')}`;
            
            navigator.clipboard.writeText(resumo).then(() => {
                showAlert('üìã Resumo copiado para a √°rea de transfer√™ncia!', 'success');
            }).catch(() => {
                showAlert('‚ùå Erro ao copiar. Tente novamente.', 'danger');
            });
        }

        console.log('‚úÖ Calculadora carregada e pronta para uso!');
    </script>
</body>
</html>
