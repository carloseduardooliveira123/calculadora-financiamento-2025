<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Simulador Inteligente - Financiamento Imobili√°rio 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: flex;
            align-items: center;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1rem;
        }

        .tooltip {
            background: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 8px;
            cursor: help;
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .form-group input[type="text"],
        .form-group input[type="date"],
        .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
            text-align: right;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="date"]:focus,
        .form-group select:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            outline: none;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            margin-top: 15px;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa502, #2ed573);
            transition: all 0.3s ease;
            border-radius: 4px;
            width: 0%;
        }

        .system-toggle {
            display: flex;
            background: #e9ecef;
            border-radius: 25px;
            padding: 4px;
            margin-top: 15px;
        }

        .system-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .system-toggle button.active {
            background: #4CAF50;
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .banks-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .banks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .bank-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .bank-option:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
        }

        .bank-option.selected {
            border-color: #4CAF50;
            background: #f0f9f0;
        }

        .bank-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .bank-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .bank-details {
            font-size: 0.9rem;
            color: #666;
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
            color: #333;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #bee5eb;
        }

        .hidden {
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .banks-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Simulador Inteligente</h1>
            <p>Financiamento Imobili√°rio 2025 - Compare e escolha a melhor op√ß√£o</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2>üìã Dados da Simula√ß√£o</h2>
                
                <div class="form-group">
                    <label for="valorImovel">
                        Valor do Im√≥vel
                        <span class="tooltip" data-tooltip="Valor total do im√≥vel que voc√™ deseja financiar">?</span>
                    </label>
                    <input type="text" id="valorImovel" placeholder="Ex: 500.000,00">
                    <input type="range" class="slider" id="sliderImovel" min="100000" max="2000000" step="10000" value="500000">
                </div>

                <div class="form-group">
                    <label for="valorEntrada">
                        Valor da Entrada
                        <span class="tooltip" data-tooltip="Valor que voc√™ tem dispon√≠vel para dar de entrada">?</span>
                    </label>
                    <input type="text" id="valorEntrada" placeholder="Ex: 100.000,00">
                    <input type="range" class="slider" id="sliderEntrada" min="0" max="500000" step="5000" value="100000">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressEntrada"></div>
                    </div>
                    <small id="percentualEntrada">0% do valor do im√≥vel</small>
                </div>

                <div class="form-group">
                    <label for="rendaFamiliar">
                        Renda Familiar Bruta
                        <span class="tooltip" data-tooltip="Soma de todas as rendas comprovadas da fam√≠lia">?</span>
                    </label>
                    <input type="text" id="rendaFamiliar" placeholder="Ex: 12.000,00">
                    <input type="range" class="slider" id="sliderRenda" min="1000" max="50000" step="500" value="12000">
                </div>

                <div class="form-group">
                    <label for="dataNascimento">
                        Data de Nascimento
                        <span class="tooltip" data-tooltip="Necess√°ria para calcular idade e verificar programas especiais para jovens">?</span>
                    </label>
                    <input type="date" id="dataNascimento">
                </div>

                <div class="form-group">
                    <label>Tipo de Im√≥vel</label>
                    <div class="system-toggle">
                        <button type="button" class="tipo-imovel-btn active" data-tipo="novo">Novo</button>
                        <button type="button" class="tipo-imovel-btn" data-tipo="usado">Usado</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="prazoFinanciamento">Prazo do Financiamento</label>
                    <select id="prazoFinanciamento">
                        <option value="180">15 anos (180 parcelas)</option>
                        <option value="240">20 anos (240 parcelas)</option>
                        <option value="300">25 anos (300 parcelas)</option>
                        <option value="360" selected>30 anos (360 parcelas)</option>
                        <option value="420">35 anos (420 parcelas)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Sistema de Amortiza√ß√£o</label>
                    <div class="system-toggle">
                        <button type="button" class="system-btn active" data-system="SAC">SAC</button>
                        <button type="button" class="system-btn" data-system="PRICE">PRICE</button>
                    </div>
                </div>
            </div>

            <div class="banks-section">
                <h2>üè¶ Escolha os Bancos</h2>
                <p>Selecione um ou mais bancos para comparar as condi√ß√µes</p>
                
                <div class="banks-grid">
                    <div class="bank-option" data-bank="caixa">
                        <input type="checkbox" id="banco_caixa" name="banco" value="caixa">
                        <div class="bank-name">üèõÔ∏è Caixa Econ√¥mica Federal</div>
                        <div class="bank-details">
                            Taxa: 8,16% a.a + TR<br>
                            MCMV dispon√≠vel<br>
                            At√© 90% financiamento
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bb">
                        <input type="checkbox" id="banco_bb" name="banco" value="bb">
                        <div class="bank-name">üü° Banco do Brasil</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bradesco">
                        <input type="checkbox" id="banco_bradesco" name="banco" value="bradesco">
                        <div class="bank-name">üî¥ Bradesco</div>
                        <div class="bank-details">
                            Taxa: 9,75% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Relacionamento banc√°rio
                        </div>
                    </div>

                    <div class="bank-option" data-bank="santander">
                        <input type="checkbox" id="banco_santander" name="banco" value="santander">
                        <div class="bank-name">üî∫ Santander</div>
                        <div class="bank-details">
                            Taxa: 9,49% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Condi√ß√µes especiais
                        </div>
                    </div>

                    <div class="bank-option" data-bank="itau">
                        <input type="checkbox" id="banco_itau" name="banco" value="itau">
                        <div class="bank-name">üü† Ita√∫</div>
                        <div class="bank-details">
                            Taxa: 9,89% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="inter">
                        <input type="checkbox" id="banco_inter" name="banco" value="inter">
                        <div class="bank-name">üüß Banco Inter</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            100% digital<br>
                            Processo simplificado
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" onclick="calcularFinanciamento()">
                    üìä Calcular Financiamento
                </button>
            </div>

            <div class="results-section hidden" id="resultsSection">
                <h2>üìà Resultados da Simula√ß√£o</h2>
                <div id="alertsContainer"></div>
                <div class="results-grid" id="resultsGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes
        const bancosConfig = {
            caixa: { nome: "Caixa Econ√¥mica Federal", taxa: 8.16, maxFinanciamento: 90, mcmv: true, limiteMcmv: 350000, subsidioMcmv: 47500, taxaMcmv: 5.95 },
            bb: { nome: "Banco do Brasil", taxa: 8.99, maxFinanciamento: 80, mcmv: false },
            bradesco: { nome: "Bradesco", taxa: 9.75, maxFinanciamento: 80, mcmv: false },
            santander: { nome: "Santander", taxa: 9.49, maxFinanciamento: 80, mcmv: false },
            itau: { nome: "Ita√∫", taxa: 9.89, maxFinanciamento: 80, mcmv: false },
            inter: { nome: "Banco Inter", taxa: 8.99, maxFinanciamento: 80, mcmv: false }
        };

        let sistemaAtual = 'SAC';
        let tipoImovelAtual = 'novo';

        // Fun√ß√µes auxiliares - SIMPLIFICADAS E TESTADAS
        function obterValorNumerico(inputId) {
            const valor = document.getElementById(inputId).value;
            if (!valor) return 0;
            
            // Remove pontos e v√≠rgulas, converte para n√∫mero
            const numeroLimpo = valor.replace(/\./g, '').replace(/,.*/, '');
            return parseInt(numeroLimpo) || 0;
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertsContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = message;
            container.appendChild(alert);
            setTimeout(() => { if (alert.parentNode) alert.parentNode.removeChild(alert); }, 10000);
        }

        // Setup de campos - VERS√ÉO ULTRA SIMPLES E FUNCIONAL
        function setupCurrencyInput(input) {
            // Remove listener antigo se existir
            input.removeEventListener('input', input._formatHandler);
            
            // Criar novo handler simples
            input._formatHandler = function(e) {
                // Obter apenas n√∫meros do valor digitado
                let apenasNumeros = e.target.value.replace(/[^\d]/g, '');
                
                // Se n√£o h√° n√∫meros, limpar campo
                if (!apenasNumeros) {
                    e.target.value = '';
                    return;
                }
                
                // Converter para n√∫mero e formatar
                let numero = parseInt(apenasNumeros);
                if (numero) {
                    e.target.value = numero.toLocaleString('pt-BR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
            };
            
            // Adicionar listener
            input.addEventListener('input', input._formatHandler);
            
            // Permitir teclas especiais
            input.addEventListener('keydown', function(e) {
                // Lista de teclas sempre permitidas
                const permitidas = [
                    'Backspace', 'Delete', 'Tab', 'Enter', 'Escape',
                    'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown',
                    'Home', 'End'
                ];
                
                // Permitir teclas especiais e Ctrl+qualquercoisa
                if (permitidas.includes(e.key) || e.ctrlKey || e.metaKey) {
                    return; // Permitir
                }
                
                // Permitir apenas d√≠gitos 0-9
                if (!/^[0-9]$/.test(e.key)) {
                    e.preventDefault(); // Bloquear
                }
            });
            
            // Limpar campo quando focar se for zero
            input.addEventListener('focus', function(e) {
                if (e.target.value === '0,00') {
                    e.target.value = '';
                }
            });
        }

        function updateProgress() {
            const valorImovel = obterValorNumerico('valorImovel');
            const valorEntrada = obterValorNumerico('valorEntrada');
            
            if (valorImovel > 0) {
                const percentual = (valorEntrada / valorImovel) * 100;
                const progressFill = document.getElementById('progressEntrada');
                const percentualText = document.getElementById('percentualEntrada');
                
                progressFill.style.width = Math.min(percentual, 100) + '%';
                percentualText.textContent = `${percentual.toFixed(1)}% do valor do im√≥vel`;
                
                if (percentual < 20) progressFill.style.background = '#ff4757';
                else if (percentual < 30) progressFill.style.background = '#ffa502';
                else progressFill.style.background = '#2ed573';
            }
        }

        function calcularIdade() {
            const dataNascimento = document.getElementById('dataNascimento').value;
            if (!dataNascimento) return 0;
            
            const hoje = new Date();
            const nascimento = new Date(dataNascimento);
            let idade = hoje.getFullYear() - nascimento.getFullYear();
            const mes = hoje.getMonth() - nascimento.getMonth();
            
            if (mes < 0 || (mes === 0 && hoje.getDate() < nascimento.getDate())) {
                idade--;
            }
            return idade;
        }

        function verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar) {
            const banco = bancosConfig[bancoCodigo];
            if (!banco.mcmv) return { elegivel: false, motivo: 'Banco n√£o oferece MCMV' };
            if (rendaFamiliar < 2400 || rendaFamiliar > 8000) return { elegivel: false, motivo: 'Renda fora da faixa MCMV' };
            if (valorImovel > 350000) return { elegivel: false, motivo: 'Valor do im√≥vel acima do limite MCMV' };
            return { elegivel: true, motivo: 'Eleg√≠vel para MCMV' };
        }

        function calcularSAC(valor, taxaMensal, prazoMeses) {
            const amortizacao = valor / prazoMeses;
            const jurosPrimeiraParcela = valor * taxaMensal;
            return amortizacao + jurosPrimeiraParcela;
        }

        function calcularPRICE(valor, taxaMensal, prazoMeses) {
            if (taxaMensal === 0) return valor / prazoMeses;
            return valor * (taxaMensal * Math.pow(1 + taxaMensal, prazoMeses)) / (Math.pow(1 + taxaMensal, prazoMeses) - 1);
        }

        // Fun√ß√£o principal
        function calcularFinanciamento() {
            const valorImovel = obterValorNumerico('valorImovel');
            const valorEntrada = obterValorNumerico('valorEntrada');
            const rendaFamiliar = obterValorNumerico('rendaFamiliar');
            const prazoMeses = parseInt(document.getElementById('prazoFinanciamento').value);
            const idade = calcularIdade();
            
            // Valida√ß√µes
            if (!valorImovel || valorImovel <= 0) { showAlert('‚ùå Informe o valor do im√≥vel.', 'danger'); return; }
            if (valorEntrada < 0) { showAlert('‚ùå Informe o valor da entrada.', 'danger'); return; }
            if (!rendaFamiliar || rendaFamiliar <= 0) { showAlert('‚ùå Informe a renda familiar.', 'danger'); return; }
            if (!document.getElementById('dataNascimento').value) { showAlert('‚ùå Informe a data de nascimento.', 'danger'); return; }
            if (valorEntrada >= valorImovel) { showAlert('‚ùå O valor da entrada n√£o pode ser maior ou igual ao valor do im√≥vel.', 'danger'); return; }

            const idadeFinalFinanciamento = idade + (prazoMeses / 12);
            if (idadeFinalFinanciamento > 80) {
                showAlert(`‚ö†Ô∏è Prazo muito longo! Com sua idade (${idade} anos), o prazo m√°ximo seria ${Math.floor((80 - idade) * 12)} meses.`, 'warning');
                return;
            }

            const bancosSelecionados = Array.from(document.querySelectorAll('input[name="banco"]:checked')).map(cb => cb.value);
            if (bancosSelecionados.length === 0) { showAlert('‚ö†Ô∏è Selecione pelo menos um banco para simular.', 'warning'); return; }

            document.getElementById('alertsContainer').innerHTML = '';
            
            const resultados = [];
            bancosSelecionados.forEach(bancoCodigo => {
                const resultado = calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar, prazoMeses, idade);
                if (resultado) resultados.push(resultado);
            });

            exibirResultados(resultados);
        }

        function calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar, prazoMeses, idade) {
            const banco = bancosConfig[bancoCodigo];
            let valorFinanciar = valorImovel - valorEntrada;
            
            const elegibilidadeMcmv = verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar);
            
            let taxa = banco.taxa;
            let subsidio = 0;
            
            if (tipoImovelAtual === 'usado') taxa += 0.5;
            if (idade <= 35) taxa -= 0.3;
            
            if (elegibilidadeMcmv.elegivel) {
                taxa = banco.taxaMcmv || banco.taxa;
                subsidio = banco.subsidioMcmv || 0;
                valorFinanciar = Math.max(0, valorFinanciar - subsidio);
            }

            let maxFinanciamento = banco.maxFinanciamento;
            if (tipoImovelAtual === 'usado') maxFinanciamento = Math.min(maxFinanciamento, 80);
            if (elegibilidadeMcmv.elegivel) maxFinanciamento = 90;

            const percentualFinanciamento = (valorFinanciar / valorImovel) * 100;
            
            if (percentualFinanciamento > maxFinanciamento) {
                const entradaMinima = valorImovel * (1 - maxFinanciamento / 100);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Entrada insuficiente. Necess√°rio pelo menos ${formatarMoeda(entradaMinima)} (${maxFinanciamento}% m√°x. financiamento)`
                };
            }

            const taxaMensal = taxa / 100 / 12;
            let prestacao = sistemaAtual === 'SAC' ? calcularSAC(valorFinanciar, taxaMensal, prazoMeses) : calcularPRICE(valorFinanciar, taxaMensal, prazoMeses);

            const maxPrestacao = rendaFamiliar * 0.3;
            if (prestacao > maxPrestacao) {
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Renda insuficiente. Presta√ß√£o seria ${formatarMoeda(prestacao)}, m√°ximo permitido: ${formatarMoeda(maxPrestacao)}`
                };
            }

            const totalPago = prestacao * prazoMeses + valorEntrada;
            const jurosTotal = totalPago - valorImovel;

            return {
                banco: banco.nome,
                aprovado: true,
                valorImovel: valorImovel,
                valorEntrada: valorEntrada,
                valorFinanciar: valorFinanciar,
                prestacao: prestacao,
                prazoAnos: prazoMeses / 12,
                taxa: taxa,
                totalPago: totalPago,
                jurosTotal: jurosTotal,
                sistema: sistemaAtual,
                mcmv: elegibilidadeMcmv.elegivel,
                subsidio: subsidio,
                percentualRenda: (prestacao / rendaFamiliar) * 100,
                tipoImovel: tipoImovelAtual,
                idade: idade
            };
        }

        function exibirResultados(resultados) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsGrid = document.getElementById('resultsGrid');
            
            resultsGrid.innerHTML = '';
            
            const aprovados = resultados.filter(r => r.aprovado);
            const reprovados = resultados.filter(r => !r.aprovado);

            reprovados.forEach(resultado => {
                showAlert(`‚ùå ${resultado.banco}: ${resultado.motivo}`, 'danger');
            });

            if (aprovados.length === 0) {
                showAlert('‚ùå Nenhuma simula√ß√£o foi aprovada. Verifique os valores informados.', 'warning');
                resultsSection.classList.remove('hidden');
                return;
            }

            showAlert(`‚úÖ ${aprovados.length} banco(s) aprovaram o financiamento!`, 'success');

            aprovados.sort((a, b) => a.prestacao - b.prestacao);

            aprovados.forEach((resultado, index) => {
                const card = criarCardResultado(resultado, index === 0);
                resultsGrid.appendChild(card);
            });

            resultsSection.classList.remove('hidden');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        function criarCardResultado(resultado, melhorOpcao) {
            const card = document.createElement('div');
            card.className = 'result-card';
            
            if (melhorOpcao) {
                card.style.borderLeftColor = '#4CAF50';
                card.style.borderLeftWidth = '6px';
                card.style.background = '#f8fff8';
            }

            const badge = resultado.mcmv ? 
                '<span style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 10px; font-weight: 600;">MCMV</span>' : 
                '';
            
            const melhorBadge = melhorOpcao ? 
                '<span style="background: #FFD700; color: #333; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 10px; font-weight: 600;">‚≠ê MELHOR</span>' : 
                '';

            const jovemBadge = resultado.idade <= 35 ? 
                '<span style="background: #17a2b8; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 5px; font-weight: 600;">JOVEM</span>' : 
                '';

            const tipoImovelBadge = resultado.tipoImovel === 'novo' ?
                '<span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 5px; font-weight: 600;">NOVO</span>' :
                '<span style="background: #6c757d; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.8em; margin-left: 5px; font-weight: 600;">USADO</span>';

            card.innerHTML = `
                <h3>${resultado.banco}${badge}${melhorBadge}${jovemBadge}${tipoImovelBadge}</h3>
                
                <div class="result-item">
                    <span class="result-label">üí∞ Presta√ß√£o ${resultado.sistema}:</span>
                    <span class="result-value" style="color: #4CAF50; font-size: 1.3em; font-weight: 700;">${formatarMoeda(resultado.prestacao)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üìä % da Renda:</span>
                    <span class="result-value" style="color: ${resultado.percentualRenda > 25 ? '#ff6b6b' : '#4CAF50'};">${resultado.percentualRenda.toFixed(1)}%</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üè† Valor Financiado:</span>
                    <span class="result-value">${formatarMoeda(resultado.valorFinanciar)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üìà Taxa de Juros:</span>
                    <span class="result-value">${resultado.taxa.toFixed(2)}% a.a + TR</span>
                </div>
                
                ${resultado.subsidio > 0 ? `
                <div class="result-item">
                    <span class="result-label">üéÅ Subs√≠dio MCMV:</span>
                    <span class="result-value" style="color: #4CAF50; font-weight: 700;">-${formatarMoeda(resultado.subsidio)}</span>
                </div>
                ` : ''}
                
                <div class="result-item">
                    <span class="result-label">üí∏ Total de Juros:</span>
                    <span class="result-value" style="color: #ff6b6b;">${formatarMoeda(resultado.jurosTotal)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üí∞ Total Pago:</span>
                    <span class="result-value" style="font-weight: 700;">${formatarMoeda(resultado.totalPago)}</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">‚è∞ Prazo:</span>
                    <span class="result-value">${resultado.prazoAnos} anos</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">üë§ Idade Final:</span>
                    <span class="result-value">${Math.round(resultado.idade + resultado.prazoAnos)} anos</span>
                </div>
            `;

            return card;
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Calculadora carregada e funcionando!');
            
            // Valores iniciais com formata√ß√£o simples
            document.getElementById('valorImovel').value = '500.000,00';
            document.getElementById('valorEntrada').value = '100.000,00';
            document.getElementById('rendaFamiliar').value = '12.000,00';
            
            // Data inicial (30 anos atr√°s)
            const hoje = new Date();
            const dataInicial = new Date(hoje.getFullYear() - 30, hoje.getMonth(), hoje.getDate());
            document.getElementById('dataNascimento').value = dataInicial.toISOString().split('T')[0];

            // Garantir checkboxes desmarcados
            document.querySelectorAll('input[type="checkbox"][name="banco"]').forEach(cb => {
                cb.checked = false;
            });

            // Setup dos campos de entrada
            setupCurrencyInput(document.getElementById('valorImovel'));
            setupCurrencyInput(document.getElementById('valorEntrada'));
            setupCurrencyInput(document.getElementById('rendaFamiliar'));

            // Setup dos sliders
            const valorImovel = document.getElementById('valorImovel');
            const sliderImovel = document.getElementById('sliderImovel');
            const valorEntrada = document.getElementById('valorEntrada');
            const sliderEntrada = document.getElementById('sliderEntrada');
            const rendaFamiliar = document.getElementById('rendaFamiliar');
            const sliderRenda = document.getElementById('sliderRenda');

            valorImovel.addEventListener('input', function() {
                const valor = obterValorNumerico('valorImovel');
                sliderImovel.value = valor;
                sliderEntrada.max = valor;
                updateProgress();
            });

            sliderImovel.addEventListener('input', function() {
                const numero = parseInt(this.value);
                valorImovel.value = numero.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                sliderEntrada.max = this.value;
                updateProgress();
            });

            valorEntrada.addEventListener('input', function() {
                const valor = obterValorNumerico('valorEntrada');
                sliderEntrada.value = valor;
                updateProgress();
            });

            sliderEntrada.addEventListener('input', function() {
                const numero = parseInt(this.value);
                valorEntrada.value = numero.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                updateProgress();
            });

            sliderRenda.addEventListener('input', function() {
                const numero = parseInt(this.value);
                rendaFamiliar.value = numero.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            });

            // Setup dos bancos
            document.querySelectorAll('.bank-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.target.type === 'checkbox') return;
                    
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        this.classList.add('selected');
                    } else {
                        this.classList.remove('selected');
                    }
                });
            });

            // Setup do sistema de amortiza√ß√£o
            document.querySelectorAll('.system-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.system-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    sistemaAtual = this.dataset.system;
                });
            });

            // Setup do tipo de im√≥vel
            document.querySelectorAll('.tipo-imovel-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tipo-imovel-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    tipoImovelAtual = this.dataset.tipo;
                });
            });

            // Progresso inicial
            updateProgress();
            
            console.log('‚úÖ Inicializa√ß√£o completa - CALCULADORA PRONTA!');
        });

        console.log('üöÄ Calculadora de Financiamento v4.0 - LIMPA E FUNCIONAL');
    </script>
</body>
</html>
