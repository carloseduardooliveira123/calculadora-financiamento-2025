<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Simulador Inteligente - Financiamento Imobili√°rio 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .form-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: flex;
            align-items: center;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 1.1rem;
        }

        .tooltip {
            background: #007bff;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 8px;
            cursor: help;
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            margin-bottom: 5px;
        }

        .input-wrapper {
            position: relative;
        }

        .form-group input[type="number"] {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input[type="number"]:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
            outline: none;
        }

        .slider-container {
            margin-top: 15px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            -webkit-appearance: none;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ffa502, #2ed573);
            transition: all 0.3s ease;
            border-radius: 4px;
            width: 0%;
        }

        .banks-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .banks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .bank-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .bank-option:hover {
            border-color: #4CAF50;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
        }

        .bank-option.selected {
            border-color: #4CAF50;
            background: #f0f9f0;
        }

        .bank-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .bank-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .bank-details {
            font-size: 0.9rem;
            color: #666;
        }

        .system-toggle {
            display: flex;
            background: #e9ecef;
            border-radius: 25px;
            padding: 4px;
            margin-top: 15px;
        }

        .system-toggle button {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .system-toggle button.active {
            background: #4CAF50;
            color: white;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .calculate-btn {
            width: 100%;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
        }

        .results-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            grid-column: 1 / -1;
            margin-top: 20px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .result-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            font-weight: 600;
            color: #333;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #bee5eb;
        }

        .comparator {
            margin-top: 30px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .comparator-header {
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .banks-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè† Simulador Inteligente</h1>
            <p>Financiamento Imobili√°rio 2025 - Compare e escolha a melhor op√ß√£o</p>
        </div>

        <div class="main-content">
            <div class="form-section">
                <h2>üìã Dados da Simula√ß√£o</h2>
                
                <div class="form-group">
                    <label for="valorImovel">
                        Valor do Im√≥vel
                        <span class="tooltip" data-tooltip="Valor total do im√≥vel que voc√™ deseja financiar">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="valorImovel" placeholder="Ex: 500000" min="0" step="1000">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderImovel" min="100000" max="2000000" step="10000" value="500000">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="valorEntrada">
                        Valor da Entrada
                        <span class="tooltip" data-tooltip="Valor que voc√™ tem dispon√≠vel para dar de entrada">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="valorEntrada" placeholder="Ex: 100000" min="0" step="1000">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderEntrada" min="0" max="500000" step="5000" value="100000">
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressEntrada"></div>
                        </div>
                        <small id="percentualEntrada">0% do valor do im√≥vel</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="rendaFamiliar">
                        Renda Familiar Bruta
                        <span class="tooltip" data-tooltip="Soma de todas as rendas comprovadas da fam√≠lia">?</span>
                    </label>
                    <div class="input-wrapper">
                        <input type="number" id="rendaFamiliar" placeholder="Ex: 12000" min="0" step="100">
                        <div class="slider-container">
                            <input type="range" class="slider" id="sliderRenda" min="1000" max="50000" step="500" value="12000">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Sistema de Amortiza√ß√£o</label>
                    <div class="system-toggle">
                        <button type="button" class="system-btn active" data-system="SAC">
                            SAC <span class="tooltip" data-tooltip="Parcelas decrescentes, juros menores no total">?</span>
                        </button>
                        <button type="button" class="system-btn" data-system="PRICE">
                            PRICE <span class="tooltip" data-tooltip="Parcelas fixas, mais f√°cil de planejar">?</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="banks-section">
                <h2>üè¶ Escolha os Bancos</h2>
                <p>Selecione um ou mais bancos para comparar as condi√ß√µes</p>
                
                <div class="banks-grid">
                    <div class="bank-option" data-bank="caixa">
                        <input type="checkbox" id="banco_caixa" name="banco" value="caixa">
                        <div class="bank-name">üèõÔ∏è Caixa Econ√¥mica Federal</div>
                        <div class="bank-details">
                            Taxa: 8,16% a.a + TR<br>
                            MCMV dispon√≠vel<br>
                            At√© 90% financiamento
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bb">
                        <input type="checkbox" id="banco_bb" name="banco" value="bb">
                        <div class="bank-name">üü° Banco do Brasil</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="bradesco">
                        <input type="checkbox" id="banco_bradesco" name="banco" value="bradesco">
                        <div class="bank-name">üî¥ Bradesco</div>
                        <div class="bank-details">
                            Taxa: 9,75% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Relacionamento banc√°rio
                        </div>
                    </div>

                    <div class="bank-option" data-bank="santander">
                        <input type="checkbox" id="banco_santander" name="banco" value="santander">
                        <div class="bank-name">üî∫ Santander</div>
                        <div class="bank-details">
                            Taxa: 9,49% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Condi√ß√µes especiais
                        </div>
                    </div>

                    <div class="bank-option" data-bank="itau">
                        <input type="checkbox" id="banco_itau" name="banco" value="itau">
                        <div class="bank-name">üü† Ita√∫</div>
                        <div class="bank-details">
                            Taxa: 9,89% a.a + TR<br>
                            Financiamento at√© 80%<br>
                            Prazo at√© 35 anos
                        </div>
                    </div>

                    <div class="bank-option" data-bank="inter">
                        <input type="checkbox" id="banco_inter" name="banco" value="inter">
                        <div class="bank-name">üüß Banco Inter</div>
                        <div class="bank-details">
                            Taxa: 8,99% a.a + TR<br>
                            100% digital<br>
                            Processo simplificado
                        </div>
                    </div>
                </div>

                <button class="calculate-btn" id="calcularBtn">
                    üìä Calcular Financiamento
                </button>
            </div>

            <div class="results-section hidden" id="resultsSection">
                <h2>üìà Resultados da Simula√ß√£o</h2>
                <div id="alertsContainer"></div>
                <div class="results-grid" id="resultsGrid"></div>
                
                <div class="comparator hidden" id="comparator">
                    <div class="comparator-header">
                        üîç Comparativo Detalhado
                    </div>
                    <table class="comparison-table" id="comparisonTable">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes dos bancos com dados corretos
        const bancosConfig = {
            caixa: {
                nome: "Caixa Econ√¥mica Federal",
                taxa: 8.16,
                maxFinanciamento: 90, // MCMV permite at√© 90%
                mcmv: true,
                limiteMcmv: 350000,
                subsidioMcmv: 47500,
                taxaMcmv: 5.95
            },
            bb: {
                nome: "Banco do Brasil",
                taxa: 8.99,
                maxFinanciamento: 80,
                mcmv: false
            },
            bradesco: {
                nome: "Bradesco",
                taxa: 9.75,
                maxFinanciamento: 80,
                mcmv: false
            },
            santander: {
                nome: "Santander",
                taxa: 9.49,
                maxFinanciamento: 80,
                mcmv: false
            },
            itau: {
                nome: "Ita√∫",
                taxa: 9.89,
                maxFinanciamento: 80,
                mcmv: false
            },
            inter: {
                nome: "Banco Inter",
                taxa: 8.99,
                maxFinanciamento: 80,
                mcmv: false
            }
        };

        let sistemaAtual = 'SAC';

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM carregado, iniciando setup...');
            
            // Garantir que todos os checkboxes iniciem desmarcados
            document.querySelectorAll('input[type="checkbox"][name="banco"]').forEach(cb => {
                cb.checked = false;
            });

            // Configurar valores iniciais
            document.getElementById('valorImovel').value = 500000;
            document.getElementById('valorEntrada').value = 100000;
            document.getElementById('rendaFamiliar').value = 12000;

            // Configurar sliders
            setupSliders();
            
            // Configurar eventos dos bancos
            setupBankSelection();
            
            // Configurar sistema de amortiza√ß√£o
            setupSystemToggle();

            // Configurar bot√£o de c√°lculo
            document.getElementById('calcularBtn').addEventListener('click', calcularFinanciamento);

            // Atualizar progresso inicial
            updateProgress();
            
            console.log('Setup conclu√≠do');
        });

        function setupSliders() {
            console.log('Configurando sliders...');
            
            const valorImovel = document.getElementById('valorImovel');
            const sliderImovel = document.getElementById('sliderImovel');
            const valorEntrada = document.getElementById('valorEntrada');
            const sliderEntrada = document.getElementById('sliderEntrada');
            const rendaFamiliar = document.getElementById('rendaFamiliar');
            const sliderRenda = document.getElementById('sliderRenda');

            // Sincronizar input do im√≥vel com slider
            valorImovel.addEventListener('input', function() {
                sliderImovel.value = this.value;
                updateProgress();
                updateSliderEntradaMax();
            });

            sliderImovel.addEventListener('input', function() {
                valorImovel.value = this.value;
                updateProgress();
                updateSliderEntradaMax();
            });

            // Sincronizar input da entrada com slider
            valorEntrada.addEventListener('input', function() {
                sliderEntrada.value = this.value;
                updateProgress();
            });

            sliderEntrada.addEventListener('input', function() {
                valorEntrada.value = this.value;
                updateProgress();
            });

            // Sincronizar input da renda com slider
            rendaFamiliar.addEventListener('input', function() {
                sliderRenda.value = this.value;
            });

            sliderRenda.addEventListener('input', function() {
                rendaFamiliar.value = this.value;
            });
        }

        function updateSliderEntradaMax() {
            const valorImovel = parseFloat(document.getElementById('valorImovel').value) || 0;
            const sliderEntrada = document.getElementById('sliderEntrada');
            sliderEntrada.max = valorImovel;
        }

        function updateProgress() {
            const valorImovel = parseFloat(document.getElementById('valorImovel').value) || 0;
            const valorEntrada = parseFloat(document.getElementById('valorEntrada').value) || 0;
            
            if (valorImovel > 0) {
                const percentual = (valorEntrada / valorImovel) * 100;
                const progressFill = document.getElementById('progressEntrada');
                const percentualText = document.getElementById('percentualEntrada');
                
                progressFill.style.width = Math.min(percentual, 100) + '%';
                percentualText.textContent = `${percentual.toFixed(1)}% do valor do im√≥vel`;
                
                // Colorir baseado no percentual
                if (percentual < 20) {
                    progressFill.style.background = '#ff4757';
                } else if (percentual < 30) {
                    progressFill.style.background = '#ffa502';
                } else {
                    progressFill.style.background = '#2ed573';
                }
            }
        }

        function setupBankSelection() {
            console.log('Configurando sele√ß√£o de bancos...');
            
            document.querySelectorAll('.bank-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    // Evitar duplo clique
                    if (e.target.type === 'checkbox') return;
                    
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    if (checkbox.checked) {
                        this.classList.add('selected');
                        console.log('Banco selecionado:', checkbox.value);
                    } else {
                        this.classList.remove('selected');
                        console.log('Banco desmarcado:', checkbox.value);
                    }
                });
            });
        }

        function setupSystemToggle() {
            console.log('Configurando toggle de sistema...');
            
            document.querySelectorAll('.system-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.system-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    sistemaAtual = this.dataset.system;
                    console.log('Sistema alterado para:', sistemaAtual);
                });
            });
        }

        function calcularFinanciamento() {
            console.log('Iniciando c√°lculo...');
            
            const valorImovel = parseFloat(document.getElementById('valorImovel').value);
            const valorEntrada = parseFloat(document.getElementById('valorEntrada').value);
            const rendaFamiliar = parseFloat(document.getElementById('rendaFamiliar').value);
            
            console.log('Valores:', { valorImovel, valorEntrada, rendaFamiliar, sistemaAtual });
            
            // Valida√ß√µes b√°sicas
            if (!valorImovel || valorImovel <= 0) {
                showAlert('Informe o valor do im√≥vel.', 'danger');
                return;
            }

            if (!valorEntrada || valorEntrada < 0) {
                showAlert('Informe o valor da entrada.', 'danger');
                return;
            }

            if (!rendaFamiliar || rendaFamiliar <= 0) {
                showAlert('Informe a renda familiar.', 'danger');
                return;
            }

            if (valorEntrada >= valorImovel) {
                showAlert('O valor da entrada n√£o pode ser maior ou igual ao valor do im√≥vel.', 'danger');
                return;
            }

            // Verificar bancos selecionados
            const bancosSelecionados = Array.from(document.querySelectorAll('input[name="banco"]:checked'))
                .map(cb => cb.value);

            console.log('Bancos selecionados:', bancosSelecionados);

            if (bancosSelecionados.length === 0) {
                showAlert('Selecione pelo menos um banco para simular.', 'warning');
                return;
            }

            // Calcular para cada banco
            const resultados = [];
            bancosSelecionados.forEach(bancoCodigo => {
                console.log('Calculando para banco:', bancoCodigo);
                const resultado = calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar);
                if (resultado) {
                    resultados.push(resultado);
                    console.log('Resultado:', resultado);
                }
            });

            // Exibir resultados
            exibirResultados(resultados);
        }

        function calcularBanco(bancoCodigo, valorImovel, valorEntrada, rendaFamiliar) {
            const banco = bancosConfig[bancoCodigo];
            let valorFinanciar = valorImovel - valorEntrada;
            
            console.log(`Calculando ${banco.nome}: Valor a financiar inicial: ${valorFinanciar}`);
            
            // Verificar se √© eleg√≠vel para MCMV
            const elegibilidadeMcmv = verificarMCMV(bancoCodigo, valorImovel, rendaFamiliar);
            
            let taxa = banco.taxa;
            let subsidio = 0;
            
            if (elegibilidadeMcmv.elegivel) {
                taxa = banco.taxaMcmv || banco.taxa;
                subsidio = banco.subsidioMcmv || 0;
                valorFinanciar = Math.max(0, valorFinanciar - subsidio);
                console.log(`MCMV eleg√≠vel: Taxa: ${taxa}, Subs√≠dio: ${subsidio}, Valor final: ${valorFinanciar}`);
            }

            // Verificar percentual m√°ximo de financiamento
            const percentualFinanciamento = (valorFinanciar / valorImovel) * 100;
            const maxPermitido = elegibilidadeMcmv.elegivel ? 90 : banco.maxFinanciamento;
            
            console.log(`Percentual financiamento: ${percentualFinanciamento.toFixed(1)}%, M√°ximo: ${maxPermitido}%`);
            
            if (percentualFinanciamento > maxPermitido) {
                const entradaMinima = valorImovel * (1 - maxPermitido / 100);
                return {
                    banco: banco.nome,
                    aprovado: false,
                    motivo: `Entrada insuficiente. Necess√°rio pelo menos R$ ${formatarMoeda(entradaMinima)} (${maxPermitido}% m√°x. financiamento)`,
                    entradaMinima: entradaMinima,
                    mcmv: elegibilidadeMcmv.elegivel,
                    subsidio: subsidio
                };
            }

            // Calcular presta√ß√£o
            const prazoMeses = 360; // 30 anos
            const taxaMensal = taxa / 100 / 12;
            
            let prestacao;
            if (sistemaAtual === 'SAC') {
                prestacao = calcularSAC(valorFinanciar, taxaMensal, prazoMeses);
            } else {
                prestacao = calcularPRICE(valorFinanciar, taxaMensal, prazoMeses);
            }

            console.log(`Presta√ß√£o ${sistemaAtual}: ${formatarMoeda(prestacao)}`);

            // Verificar capacidade de pagamento (30% da renda)
            const maxPrestacao = rendaFamiliar * 0.3;
            
            if (prestacao > maxPrestacao) {
                return {
                    banco: banco.nome,
                    aprovado: false,
